<?
@session_start();
if($_POST){
$fpath = '../';
require_once($fpath."includes/connect.php");
include "update_by.php";
$code_old=$_POST["code_old"];
$code_new=$_POST["code_new"];

$numrow = $db->count_row(TB_BIODATA_TAB," WHERE EMP_ID = '$code_new' ",$conn); 

if($numrow>0){
	print $code_new." หมายเลขบุคคลการนี้มีอยู่ในฐานข้อมูลแล้ว";
}

$numrow_old = $db->count_row(TB_BIODATA_TAB," WHERE EMP_ID = '$code_old' ",$conn);

if($numrow==0){
$sql="SELECT * FROM ".TB_BIODATA_TAB." WHERE EMP_ID='".$code_old."'";
$stdt = oci_parse($conn,$sql);
oci_execute($stdt);

	while($rc = oci_fetch_array($stdt)) {
		$data["BIO_TITLE_TH"]=$rc["BIO_TITLE_TH"];
		$data["BIO_TITLE2_TH"]=$rc["BIO_TITLE2_TH"];
		$data["BIO_TITLE3_TH"]=$rc["BIO_TITLE3_TH"];
		$data["BIO_FNAME_TH"]=$rc["BIO_FNAME_TH"];
		$data["BIO_MNAME_TH"]=$rc["BIO_MNAME_TH"];
		$data["BIO_LNAME_TH"]=$rc["BIO_LNAME_TH"];
		$data["BIO_TITLE_EN"]=$rc["BIO_TITLE_EN"];
		$data["BIO_FNAME_EN"]=$rc["BIO_FNAME_EN"];
		$data["BIO_MNAME_EN"]=$rc["BIO_MNAME_EN"];
		$data["BIO_LNAME_EN"]=$rc["BIO_LNAME_EN"];
		$data["BIO_SEX"]=$rc["BIO_SEX"];
		$data["BIO_NATION1"]=$rc["BIO_NATION1"];
		$data["BIO_NATION2"]=$rc["BIO_NATION2"];
		$data["BIO_RELIGION"]=$rc["BIO_RELIGION"];
		$data["BIO_BIRTHDAY"]=$rc["BIO_BIRTHDAY"];
		$data["PERSON_ID"]=$rc["PERSON_ID"];
		$data["BIO_ID_FROM"]=$rc["BIO_ID_FROM"];
		$data["BIO_ID_FROM_P"]=$rc["BIO_ID_FROM_P"];
		$data["BIO_ID_DATE_BEGIN"]=$rc["BIO_ID_DATE_BEGIN"];
		$data["BIO_ID_DATE_EXP"]=$rc["BIO_ID_DATE_EXP"];
		$data["BIO_TAX_ID"]=$rc["BIO_TAX_ID"];
		$data["BIO_GOV_ID"]=$rc["BIO_GOV_ID"];
		$data["BIO_BANK_ACC_ID"]=$rc["BIO_BANK_ACC_ID"];
		$data["BIO_BANK"]=$rc["BIO_BANK"];
		$data["BIO_STATUS"]=$rc["BIO_STATUS"];
		$data["BIO_BLOOD_GROUP"]=$rc["BIO_BLOOD_GROUP"];
		$data["BIO_BLOOD_TYPE"]=$rc["BIO_BLOOD_TYPE"];
		$data["BIO_H_PHONE"]=$rc["BIO_H_PHONE"];
		$data["BIO_H_FAX"]=$rc["BIO_H_FAX"];
		$data["BIO_MOBILE_1"]=$rc["BIO_MOBILE_1"];
		$data["BIO_MOBILE_2"]=$rc["BIO_MOBILE_2"];
		$data["BIO_EMAIL1"]=$rc["BIO_EMAIL1"];
		$data["BIO_EMAIL2"]=$rc["BIO_EMAIL2"];
		$data["BIO_ID_CARD_FILE"]=$rc["BIO_ID_CARD_FILE"];
		$data["BIO_ACC_BANK_FILE"]=$rc["BIO_ACC_BANK_FILE"];
		$data["BIO_PIC_FILE"]=$rc["BIO_PIC_FILE"];
		$data["LAST_UPDATE"]=$rc["LAST_UPDATE"];
		$data["UPDATE_BY"]=$rc["UPDATE_BY"];
		$data["BIO_NAME_EMER"]=$rc["BIO_NAME_EMER"];
		$data["BIO_EMER_PHONE"]=$rc["BIO_EMER_PHONE"];
		$data["BIO_GOV_ID_DATE_BEGIN"]=$rc["BIO_GOV_ID_DATE_BEGIN"];
		$data["BIO_GOV_ID_DATE_EXP"]=$rc["BIO_GOV_ID_DATE_EXP"];
	}
	
	if($numrow_old>0){
		$result=$db->add_db(TB_BIODATA_TAB,
			array(
				"EMP_ID"=>$code_new,
				"BIO_TITLE_TH"=>$data["BIO_TITLE_TH"],
				"BIO_TITLE2_TH"=>$data["BIO_TITLE2_TH"],
				"BIO_TITLE3_TH"=>$data["BIO_TITLE3_TH"],
				"BIO_FNAME_TH"=>$data["BIO_FNAME_TH"],
				"BIO_MNAME_TH"=>$data["BIO_MNAME_TH"],
				"BIO_LNAME_TH"=>$data["BIO_LNAME_TH"],
				"BIO_TITLE_EN"=>$data["BIO_TITLE_EN"],
				"BIO_FNAME_EN"=>$data["BIO_FNAME_EN"],
				"BIO_MNAME_EN"=>$data["BIO_MNAME_EN"],
				"BIO_LNAME_EN"=>$data["BIO_LNAME_EN"],
				"BIO_SEX"=>$data["BIO_SEX"],
				"BIO_NATION1"=>$data["BIO_NATION1"],
				"BIO_NATION2"=>$data["BIO_NATION2"],
				"BIO_RELIGION"=>$data["BIO_RELIGION"],
				"BIO_BIRTHDAY"=>$data["BIO_BIRTHDAY"],
				"PERSON_ID"=>$data["PERSON_ID"],
				"BIO_ID_FROM"=>$data["BIO_ID_FROM"],
				"BIO_ID_FROM_P"=>$data["BIO_ID_FROM_P"],
				"BIO_ID_DATE_BEGIN"=>$data["BIO_ID_DATE_BEGIN"],
				"BIO_ID_DATE_EXP"=>$data["BIO_ID_DATE_EXP"],
				"BIO_TAX_ID"=>$data["BIO_TAX_ID"],
				"BIO_GOV_ID"=>$data["BIO_GOV_ID"],
				"BIO_BANK_ACC_ID"=>$data["BIO_BANK_ACC_ID"],
				"BIO_BANK"=>$data["BIO_BANK"],
				"BIO_STATUS"=>$data["BIO_STATUS"],
				"BIO_BLOOD_GROUP"=>$data["BIO_BLOOD_GROUP"],
				"BIO_BLOOD_TYPE"=>$data["BIO_BLOOD_TYPE"],
				"BIO_H_PHONE"=>$data["BIO_H_PHONE"],
				"BIO_H_FAX"=>$data["BIO_H_FAX"],
				"BIO_MOBILE_1"=>$data["BIO_MOBILE_1"],
				"BIO_MOBILE_2"=>$data["BIO_MOBILE_2"],
				"BIO_EMAIL1"=>$data["BIO_EMAIL1"],
				"BIO_EMAIL2"=>$data["BIO_EMAIL2"],
				"BIO_ID_CARD_FILE"=>$data["BIO_ID_CARD_FILE"],
				"BIO_ACC_BANK_FILE"=>$data["BIO_ACC_BANK_FILE"],
				"BIO_PIC_FILE"=>$data["BIO_PIC_FILE"],
				"LAST_UPDATE"=>"TO_DATE('".date("Y-m-d H:i:s")."','YYYY-MM-DD HH24:MI:SS')",
				"UPDATE_BY"=>$update_use,
				"BIO_NAME_EMER"=>$data["BIO_NAME_EMER"],
				"BIO_GOV_ID_DATE_BEGIN"=>$data["BIO_GOV_ID_DATE_BEGIN"],
				"BIO_GOV_ID_DATE_EXP"=>$data["BIO_GOV_ID_DATE_EXP"]
			),$conn);
			$db->closedb($conn);
		}
			
			if($result){
				print "เปลี่ยนรหัสบุคคลกรเรียบร้อย";
			}
			else if($numrow_old==0){
				print "ไม่พบหมายเลขบุคคลกร $code_old";
			}
			else{
				print "ไม่สามารถเปลี่ยนรหัสบุคคลกรได้";
			}
	}
}

?>